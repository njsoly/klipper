# Material profiles configuration
# This file contains material-specific macros for Klipper

# Material constants - centralized defaults
[gcode_macro MATERIAL_CONSTANTS]
description: Central storage for material default values
variable_known_pa_defaults: [0.05, 0.06, 0.077, 0.2]
variable_pla_accel: 3200
variable_pla_pa: 0.06
variable_petg_accel: 2000
variable_petg_pa: 0.077
variable_tpu_accel: 1200
variable_tpu_pa: 0.2
gcode:
	KLIPPER_LOG MSG="=== Material Default Values ==="
	KLIPPER_LOG MSG="PLA:  Accel={printer['gcode_macro MATERIAL_CONSTANTS'].pla_accel}, PA={printer['gcode_macro MATERIAL_CONSTANTS'].pla_pa}"
	KLIPPER_LOG MSG="PETG: Accel={printer['gcode_macro MATERIAL_CONSTANTS'].petg_accel}, PA={printer['gcode_macro MATERIAL_CONSTANTS'].petg_pa}"
	KLIPPER_LOG MSG="TPU:  Accel={printer['gcode_macro MATERIAL_CONSTANTS'].tpu_accel}, PA={printer['gcode_macro MATERIAL_CONSTANTS'].tpu_pa}"
	KLIPPER_LOG MSG="Known PA defaults: {printer['gcode_macro MATERIAL_CONSTANTS'].known_pa_defaults}"

# Material-specific acceleration macros with constants
[gcode_macro SET_MATERIAL_PLA]
description: Set acceleration and motion settings optimized for PLA
gcode:
	{% set accel = printer["gcode_macro MATERIAL_CONSTANTS"].pla_accel %}
	{% set advance = printer["gcode_macro MATERIAL_CONSTANTS"].pla_pa %}
	{% set current_pa = printer.extruder.pressure_advance %}
	{% set known_defaults = printer["gcode_macro MATERIAL_CONSTANTS"].known_pa_defaults %}
	SET_VELOCITY_LIMIT ACCEL={accel}
	{% if current_pa in known_defaults %}
		SET_PRESSURE_ADVANCE ADVANCE={advance}
		KLIPPER_LOG MSG="Material settings: PLA (Accel: {accel}, PA: {advance})"
	{% else %}
		KLIPPER_LOG MSG="Material settings: PLA (Accel: {accel}, PA: {current_pa} - preserved custom value)"
	{% endif %}

[gcode_macro SET_MATERIAL_PETG]
description: Set acceleration and motion settings optimized for PETG
gcode:
	{% set accel = printer["gcode_macro MATERIAL_CONSTANTS"].petg_accel %}
	{% set advance = printer["gcode_macro MATERIAL_CONSTANTS"].petg_pa %}
	{% set current_pa = printer.extruder.pressure_advance %}
	{% set known_defaults = printer["gcode_macro MATERIAL_CONSTANTS"].known_pa_defaults %}
	SET_VELOCITY_LIMIT ACCEL={accel}
	{% if current_pa in known_defaults %}
		SET_PRESSURE_ADVANCE ADVANCE={advance}
		KLIPPER_LOG MSG="Material settings: PETG (Accel: {accel}, PA: {advance})"
	{% else %}
		KLIPPER_LOG MSG="Material settings: PETG (Accel: {accel}, PA: {current_pa} - preserved custom value)"
	{% endif %}

[gcode_macro SET_MATERIAL_TPU]
description: Set acceleration and motion settings optimized for TPU
gcode:
	{% set accel = printer["gcode_macro MATERIAL_CONSTANTS"].tpu_accel %}
	{% set advance = printer["gcode_macro MATERIAL_CONSTANTS"].tpu_pa %}
	{% set current_pa = printer.extruder.pressure_advance %}
	{% set known_defaults = printer["gcode_macro MATERIAL_CONSTANTS"].known_pa_defaults %}
	SET_VELOCITY_LIMIT ACCEL={accel}
	{% if current_pa in known_defaults %}
		SET_PRESSURE_ADVANCE ADVANCE={advance}
		KLIPPER_LOG MSG="Material settings: TPU (Accel: {accel}, PA: {advance})"
	{% else %}
		KLIPPER_LOG MSG="Material settings: TPU (Accel: {accel}, PA: {current_pa} - preserved custom value)"
	{% endif %}

[gcode_macro SET_MATERIAL_DEFAULT]
description: Reset to default acceleration and motion settings
gcode:
	SET_MATERIAL_PLA
